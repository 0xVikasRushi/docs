"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("unist-util-flatmap")),r=e(require("typescript")),n=require("path"),i=e(n),a=require("@microsoft/tsdoc"),o=require("url"),s=e(require("unist-util-visit")),c=e(require("prettier"));function l(){return(l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function f(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return u(e,void 0);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,void 0):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(r=e[Symbol.iterator]()).next.bind(r)}function p(e,t){var n=[];switch(e.kind){case r.SyntaxKind.Parameter:case r.SyntaxKind.TypeParameter:case r.SyntaxKind.FunctionExpression:case r.SyntaxKind.ArrowFunction:case r.SyntaxKind.ParenthesizedExpression:case r.SyntaxKind.VariableDeclaration:case r.SyntaxKind.VariableStatement:n.push.apply(n,r.getTrailingCommentRanges(t,e.pos)||[])}return n.push.apply(n,r.getLeadingCommentRanges(t,e.pos)||[]),n.filter((function(e){return 42===t.charCodeAt(e.pos+1)&&42===t.charCodeAt(e.pos+2)&&47!==t.charCodeAt(e.pos+3)}))}var d,m=function(){function e(e){var t=e.tsconfig,n=e.rootFiles,a=e.basedir;this.basedir=a;var o=r.readConfigFile(t,r.sys.readFile),s=r.parseJsonConfigFileContent(o.config,r.sys,"./").options,c=r.createCompilerHost(s);this.program=r.createProgram(n.map((function(e){return i.resolve(a,e)})),s,c)}var t=e.prototype;return t.findTokens=function(e,t){var n=this,i=e.split("."),a=i[0],o=i.slice(1),s=[];return t.forEachChild((function(t){if(r.isVariableStatement(t)){if(s.push.apply(s,n.findTokens(e,t.declarationList)),1===t.declarationList.declarations.length){var i=t.declarationList.declarations[0].name;i&&r.isIdentifier(i)&&i.escapedText===a&&s.push(t)}}else{var c=t.name;c&&r.isIdentifier(c)&&c.escapedText===a&&(a===e?(r.isVariableDeclaration(t)&&t.initializer&&s.push(t.initializer),s.push(t)):s.push.apply(s,n.findTokens(o.join("."),t)))}})),s},t.getComment=function(e,t,r){void 0===t&&(t="index.ts"),void 0===r&&(r=0);var n=i.resolve(this.basedir,t),o=this.program.getSourceFile(n);if(!o)throw new Error("Error retrieving source file "+o+" (looked for "+t+" in "+this.basedir+")");for(var s,c=[],l=o.getFullText(),u=f(this.findTokens(e,o));!(s=u()).done;){var d=s.value,m=p(d,l);if(m.length>0)for(var v,g=f(m);!(v=g()).done;){var h=v.value;c.push({compilerNode:d,textRange:a.TextRange.fromStringRange(l,h.pos,h.end)})}}var y=new a.TSDocConfiguration;y.addTagDefinition(new a.TSDocTagDefinition({tagName:"@overloadSummary",syntaxKind:a.TSDocTagSyntaxKind.BlockTag})),y.addTagDefinition(new a.TSDocTagDefinition({tagName:"@overloadRemarks",syntaxKind:a.TSDocTagSyntaxKind.BlockTag}));var b=new a.TSDocParser(y),x=c[r];if(!x)return console.warn("could not find overload "+r+" for "+e+" in "+t),null;var S=b.parseRange(x.textRange),T=S.docComment;return Object.assign(T,{parserContext:S,buffer:x.textRange.buffer,overloadSummary:T.customBlocks.find(this.byTagName("@overloadSummary")),overloadRemarks:T.customBlocks.find(this.byTagName("@overloadRemarks")),examples:T.customBlocks.filter(this.byTagName("@example"))})},t.byTagName=function(e){return function(t){return t.blockTag.tagName===e}},e}(),v=new WeakMap,g=function(){function e(e){var t,i,a,o,s=r.readConfigFile(e.tsconfig,r.sys.readFile);this.compilerOptions=r.parseJsonConfigFileContent(s.config,r.sys,"./").options,this.compilerHost=(i=e.externalResolutions,a={},o=[],l({},r.createCompilerHost(t=this.compilerOptions),{getCompilationSettings:function(){return t},fileExists:function(e){return!!a[n.normalize(e)]||r.sys.fileExists(e)},readFile:function(e){var t=a[n.normalize(e)];return t?t.contents:r.sys.readFile(e)},writeFile:function(e,t){e=n.normalize(e);var r=a[e]?a[e].version:1;a[e]&&a[e].contents!==t&&r++,a[e]={contents:t,version:r}},directoryExists:function(e){var t=n.normalize(e+"/");return o.some((function(e){return e.startsWith(t)}))||r.sys.directoryExists(e)},setScriptFileNames:function(e){o=e.map(n.normalize)},getScriptFileNames:function(){return o},getScriptSnapshot:function(e){var t=this.readFile(e);return t?r.ScriptSnapshot.fromString(t):void 0},getScriptVersion:function(e){var t=a[n.normalize(e)];return t?t.version.toString():String(r.sys.getModifiedTime&&r.sys.getModifiedTime(e)||"unknown, will not update without restart")},resolveModuleNames:function(e,n){var a=this;return e.map((function(e){if(e in i){var o=i[e],s=r.resolveModuleName(o.resolvedPath,n,t,a).resolvedModule;if(!s)throw new Error("external resolution "+e+" not found");return l({},s,{packageId:o.packageId})}return r.resolveModuleName(e,n,t,a).resolvedModule}))}})),this.service=r.createLanguageService(this.compilerHost,r.createDocumentRegistry())}return e.prototype.compile=function(e){this.compilerHost.setScriptFileNames([]);for(var t=0,n=Object.entries(e);t<n.length;t++){var i=n[t],a=i[0],o=i[1].code;o=o.replace(/^$/gm,"//__NEWLINE__"),this.compilerHost.writeFile(a,o)}this.compilerHost.setScriptFileNames(Object.keys(e));for(var s={},c=0,u=Object.entries(e);c<u.length;c++){var f=u[c][0],p=this.service.getEmitOutput(f).outputFiles.find((function(e){var t=e.name;return t.endsWith(".js")||t.endsWith(".jsx")})),d=p?p.text.replace(/\/\/__NEWLINE__/g,""):"",m=this.service.getCompilerOptionsDiagnostics().concat(this.service.getSyntacticDiagnostics(f)).concat(this.service.getSemanticDiagnostics(f)).map((function(e){var t=r.flattenDiagnosticMessageText(e.messageText,"\n");if(e.file&&e.start){var n=e.file.getLineAndCharacterOfPosition(e.start);return{line:n.line,character:n.character,message:t}}return{message:t}}));s[f]=l({},e[f],{code:d,diagnostics:m})}return s},e}();function h(e,t){return x(Object.entries(e).map((function(e){var r=e[0],n=e[1];return[r,l({},n,{code:b(n.code,r,t||r).trim()})]})))}function y(e,t){return x(Object.entries(e).map((function(e){var r=e[0],n=e[1],i=n.code.replace(/(\n\s*|)\/\/ (@ts-ignore|@ts-expect-error).*$/gm,"");return[r,l({},n,{code:b(i,r,t||r).trim()})]})))}function b(e,t,r){return void 0!==r&&(d=c.resolveConfig.sync(r)),d?c.format(e,l({},d,{filepath:t})):(console.error("no prettier config found for "+r+", skipping prettier step"),e)}function x(e){for(var t,r={},n=f(e);!(t=n()).done;){var i=t.value;r[i[0]]=i[1]}return r}var S=new WeakMap;function T(e,t,r,n,i,a,o){return[{type:"jsx",value:"\n    <Tabs\n      groupId=\"language\"\n      defaultValue=\"ts\"\n      values={[\n        { label: 'TypeScript', value: 'ts', },\n        { label: 'JavaScript', value: 'js', },\n      ]}\n    >        \n        <TabItem value=\"ts\">"},l({},e,{value:k(a(n,t.path,h),r)}),{type:"jsx",value:'\n        </TabItem>\n        <TabItem value="js">'},l({},e,{lang:"js",value:k(o(i,t.path,y),r)}),{type:"jsx",value:"\n        </TabItem>\n    </Tabs>"}]}function k(e,t){var r=Object.entries(e).filter((function(e){return!e[1].skip}));return 1===r.length?r[0][1].code:r.map((function(e){var r=e[1].code;return"// file: "+e[0].replace(t+"/","")+"\n"+r.trim()})).join("\n\n\n")}exports.linkDocblocks=function(e){var r=this,n=e.extractorSettings;v.has(n)||v.set(n,new m(n));var i=v.get(n);function c(e,t){return void 0===t&&(t=function(e){return e}),function(n){var i,o=function e(t){if(!t)return"";if(Array.isArray(t))return t.map((function(t){return e(t)})).join("");var r="";if(t){if(t instanceof a.DocFencedCode){var n=t.code.toString(),i="";return n=n.replace(/^\s*\/\/\s*codeblock-meta(\s.*?)$\n?/gm,(function(e,t){return i+=t,""})),"```"+t.language+i+"\n"+n+"\n```"}t instanceof a.DocExcerpt&&(r+=t.content.toString());for(var o,s=f(t.getChildNodes());!(o=s()).done;)r+=e(o.value)}return r}(n[e]);return i=t(o),r.parse(i).children}}var l={summary:c("summarySection",(function(e){return e.replace(/@summary/g,"")})),remarks:c("remarksBlock",(function(e){return e.replace(/@remarks/g,"")})),overloadSummary:c("overloadSummary",(function(e){return e.replace(/@overloadSummary/g,"")})),overloadRemarks:c("overloadRemarks",(function(e){return e.replace(/@overloadRemarks/g,"")})),examples:c("examples",(function(e){return e.replace(/@example/g,"")})),params:c("params",(function(e){return e.replace(/@param (.*) -/g,"* **$1**")}))};return function(e){return t(e,(function(e){if("paragraph"!==e.type||1!==e.children.length)return[e];var t=e.children[0];if("link"!==t.type||!t.url.startsWith("docblock://"))return[e];if(1!==t.children.length||"text"!==t.children[0].type)throw new Error("invalid meta content for docblock link");var r=t.children[0].value.split(",").map((function(e){return e.trim()})),n=new o.URL(t.url),a=n.host+n.pathname,c=n.searchParams,u=c.get("token"),f=Number.parseInt(c.get("overload")||"0");if(!u)throw new Error("token name must be provided as query parameter `token`");var p=i.getComment(u,a,f);if(!p)return[];var d=r.reduce((function(e,t){if(!(t in l))throw new Error("invalid comment section reference. valid references are "+Object.keys(l).concat(","));return e.push.apply(e,l[t](p)),e}),[]);return s({type:"fakeRoot",children:d},"code",(function(e){e.value=e.value.trimEnd()})),d}))}},exports.transpileCodeblocks=function(e){var r=e.compilerSettings,n=e.postProcessTranspiledJs,i=void 0===n?y:n,a=e.postProcessTs,o=void 0===a?h:a,c=e.assembleReplacementNodes,l=void 0===c?T:c,u=e.fileExtensions,p=void 0===u?[".mdx"]:u;S.has(r)||S.set(r,new g(r));var d=S.get(r);return function(e,r){if(!r.extname||!p.includes(r.extname))return e;var n=!1,a=!1;s(e,"import",(function(e){/\bTabs\b/.test(e.value)&&(n=!0),/\bTabItem\b/.test(e.value)&&(a=!0)})),s(e,"root",(function(e){n||e.children.unshift({type:"import",value:"import Tabs from '@theme/Tabs'"}),a||e.children.unshift({type:"import",value:"import TabItem from '@theme/TabItem'"})}));var c=0;return t(e,(function(e){if("code"===e.type&&c++,"code"!==e.type||"ts"!==e.lang)return[e];if((e.meta?e.meta.split(" "):[]).includes("no-transpile"))return[e];for(var t=r.path+"/codeBlock_"+c,n=function(e,t){var r=/^\/\/ file: ([\w\-./]+)(?: (.*))?\s*$/gm,n=r.exec(e),i={};do{var a=n?n.index+n[0].length+1:0,o=n?n[1]:"index.ts",s=(n&&n[2]||"").split(" ").includes("noEmit");n=r.exec(e);var c=e.substring(a,n?n.index:e.length);i[t+"/"+o]={code:c,skip:s}}while(n);return i}(e.value,t),a=d.compile(n),s=0,u=Object.entries(a);s<u.length;s++)for(var p,m=u[s],v=m[0],g=m[1],h=f(g.diagnostics);!(p=h()).done;){var y=p.value;if(y.line&&e.position){var b=g.code.split("\n").map((function(e,t){return String(t).padStart(3," ")+"  "+e}));r.fail("\nTypeScript error in code block in line "+y.line+" of "+v+"\n"+y.message+"\n\n"+b.slice(Math.max(0,y.line-5),y.line+6).join("\n")+"\n            ",{line:y.line+e.position.start.line,column:y.character})}else r.fail(y.message,e)}return l(e,r,t,n,a,o,i)}))}};
//# sourceMappingURL=remark-typescript-tools.cjs.production.min.js.map
